\documentclass[]{report}

\usepackage{amsmath}

\newcommand{\bra}[1]{\left<#1\right|}
\newcommand{\ket}[1]{\left|#1\right>}
\newcommand{\bket}[2]{\left<#1|#2\right>}
\newcommand{\braket}[3]{\bra{#1}#2\ket{#3}}

% Title Page
\title{\texttt{mudirac} - a Dirac equation solver for muonic atoms
	\newline
	\large Development guide}
\author{Simone Sturniolo}


\begin{document}
\maketitle

\chapter*{Introduction}

This document contains information and references on the algorithms and methods employed for the development of \texttt{mudirac}. It is meant as a technical document, to keep track of technique used and allow for modification or bug fixing in the future.

\chapter{Theory}

\section{The Dirac equation}

The basic solver makes use of the radial Dirac equation written in its coupled form, here written in atomic units:

\begin{align}\label{dirac_sys}
	Q'(r) &= \frac{k}{r}Q + \left(mc-\frac{E-V(r)}{c}\right)P \\
	P'(r) &= -\frac{k}{r}P + \left(mc+\frac{E-V(r)}{c}\right)Q
\end{align}

as found for example in \cite{weinb2008, silbar2010, gross1999} and others. In this form, the final wavefunction can be reconstructed by combining it with the appropriate spherical harmonics:

\begin{align}\label{dirac_wavef}
\left<\mathbf{r}|\psi_{k\mu}\right> = \begin{pmatrix}
\frac{P_k}{r}\bket{\mathbf{\hat{r}}}{k\mu} \\
i\frac{Q_k}{r}\bket{\mathbf{\hat{r}}}{-k\mu}
\end{pmatrix}
\end{align}

where it must be kept in mind that the quantum number $k$ depends on the total angular momentum of the electron, namely, whether its angular and spin momenta are aligned or not. It is $k=-(l+1)$ when $j = l+1/2$ and $k=l$ when $j=l-1/2$, and the spin spherical harmonics are:

\begin{equation}\label{dirac_kmu}
\ket{k\mu} = \sum_{s=\pm 1/2} c(l,\frac{1}{2};\mu-s, s)\left|l,\mu-s\right>\Phi(s)
\end{equation}

with

\begin{align}\label{dirac_spharm}
\left<\mathbf{\hat{r}}|l,\mu-s\right> = Y_{l,\mu-s}(\mathbf{\hat{r}}) \\
\Phi\left(\frac{1}{2}\right) = \begin{pmatrix}
1 \\
0
\end{pmatrix}
\qquad
\Phi\left(-\frac{1}{2}\right) = \begin{pmatrix}
0 \\
1
\end{pmatrix} 
\end{align}

with $Y_{lm}$ being the spherical harmonics, $c(l,\frac{1}{2};\mu-s, s)$ the Clebsch-Gordan coefficients \cite{weinb2008}, and $m=\mu-s$. The coefficients can also be conveniently expressed as

\begin{equation}\label{dirac_cgsym}
c(l,\frac{1}{2};\mu-s, s) = \begin{cases}
-\mathrm{sgn}(k)\sqrt{\frac{k+\frac{1}{2}-\mu}{2k+1}} \qquad s = \frac{1}{2} \\
\sqrt{\frac{k+\frac{1}{2}+\mu}{2k+1}} \qquad s = -\frac{1}{2}
\end{cases}
\end{equation}


as seen in \cite{gross1999, biedernharn1981}.\newline
Since this equation is one dimensional we don't need to worry about Q and P being complex-valued, as they will be always real. In general, P will be the `large' component, and in the limit of $c \rightarrow \infty$ we would have that $P^2(r) = r^2\Psi^2(r)$ where $\Psi$ is just the normal radial component of the Schr\"{o}dinger equation solution. A higher Q corresponds to a more `relativistic' behaviour.

\section{Energy corrections}

While the main contribution to the potential for a muonic atom is the Coulombic force generated by the nucleus, $-Z/r$, there are additional contributions that we need to consider due to the short radius and high energy of muonic orbitals \cite{borie1982}.

\subsection{Nuclear finite size}

Since muonic orbitals are squeezed in a much smaller space than electronic ones, the nucleus can not be considered as a point charge when computing their energy. The effective charge distribution of atomic nuclei is not obvious. In first approximation, one can treat the nucleus as a uniformly charged sphere of finite radius. Appropriate radii have been measured and listed in literature, and where available, these values are used \cite{angeli2013}. It should be noted that the values tabulated in the paper are values for the root mean square radius, which means they need to be multiplied by $\sqrt{5/3}$ to get the equivalent radius of a uniformly charged sphere. For any isotope for which the radius is not known, we fall back on the empirical formula \cite{borie1982}:

\begin{equation}\label{nuc_radius}
R = 1.2 A^{1/3} \mathrm{fm} = 2.267\cdot10^{-5}A^3
\end{equation}

, where the second version is in atomic units.\newline
While sufficient to achieve satisfying accuracy for most cases, this finite sphere approximation still produces significant errors in some extreme circumstances, in particular transitions between the first two shells in heavy elements such as lead. In this case, a further increase in accuracy can be achieved by smoothing the charge distribution from a sphere with a sharp cutoff to a Fermi 2-term distribution \cite{visscher1997}:

\begin{equation}\label{s:theory:fermi2}
\rho(r) = \rho_0\frac{1}{1+e^{4\ln (3) \frac{r-R_F}{\delta_F}}}
\end{equation}

, where $R_F$ and $\delta_F$ are two parameters corresponding roughly to the size of the nucleus and the thickness of its `skin', the shell across which the density falls to zero. In particular, $R_F$ is connected to the corresponding uniform sphere radius $R$  for the same nucleus by

\begin{equation}\label{s:theory:fermi2radius_heavy}
R_F = \sqrt{R^2-\frac{7}{3}\left(\frac{\pi \delta_F}{4\ln(3)}\right)^2}
\end{equation}

for atoms where in atomic mass units $A \ge 5$, while for lighter nuclei, where the above formula would fail, we set

\begin{equation}\label{s:theory:fermi2radius_light}
R_F = (2.2291\cdot10^{-5}A^{1/3}-0.90676\cdot10^{-5})
\end{equation}

in atomic units. In following with \cite{visscher1997}, we also take $\delta_F = 2.3 fm = 4.3464\cdot10^{-5}$ for all nuclei. The charge distribution in eq. \ref{s:theory:fermi2} does not produce a potential that can be described analytically.

\subsection{Vacuum polarizability}\label{vacpot}

The next term to include is the effect of the polarizability of the vacuum. The regular Coulomb law is based on the principle of vacuum having zero polarizability, but that is not an accurate description once one takes into account quantum field theory. Vacuum can be polarized by the appearance of charged particle pairs, which constitute Feynman diagrams with added loops in the photon propagator \cite{borie1982}. The biggest term is the diagram in which one electron-positron pair is created, of order $\alpha$. Diagrams with more loops will be of order $\alpha^2$ or even smaller, and diagrams involving pairs of more massive charged particles such as muons and antimuons also contribute much smaller contributions due to the higher energy required to form such particles, which makes them vanish exponentially. Accounting for this term gives rise to a correction to the Coulomb potential known as the Uehling potential \cite{johnson2001}:

\begin{equation}\label{uehl_point}
\delta V(r) = -\frac{2\alpha Z}{3\pi r}\int_0^1 du \sqrt{1-u^2}\left(\frac{1}{u}+\frac{1}{2}u\right)e^{-2cr/u}
\end{equation}

. The form seen in Eq. \ref{uehl_point} however is only valid for a point-like charge, which makes it not very useful for most muonic atoms. In presence of a charge distribution the Uehling potential becomes

\begin{equation}\label{uehl_distr}
\delta V_D(r) = -\frac{2\alpha^2}{3 r}\int_0^\infty dx x \rho(x)\int_0^1 du \sqrt{1-u^2}\left(1+\frac{1}{2}u^2\right)\left(e^{-2c|r-x|/u}+e^{-2c(r+x)/u}\right)
\end{equation}

. For the special case of a spherical distribution of charge of radius $R$ we have

\begin{equation}
\rho(x) = \begin{cases}
\frac{3}{4\pi}\frac{Z}{R^3} \qquad &x \leq R \\
0 \qquad &x > R \\
\end{cases}
\end{equation}

and thus the integral becomes

\begin{equation}\label{uehl_sphere}
\delta V_S(r) = -\frac{\alpha^2Z}{2\pi rR^3}\int_0^R dx x \int_0^1 du \sqrt{1-u^2}\left(1+\frac{1}{2}u^2\right)\left(e^{-2c|r-x|/u}+e^{-2c(r+x)/u}\right)
\end{equation}

The integral in $x$ can be carried out if we consider the two distinct cases of $x < r$ and $x \geq r$. For the first we have

\begin{multline}\label{intx_less}
X_{<}(r, u | R) = \int_0^R x \left(e^{-2c|r-x|/u}-e^{-2c(r+x)/u}\right)  dx = \\
e^{-2cr/u}\int_0^R x \left(e^{2cx/u}-e^{-2cx/u}\right)  dx = \\ e^{-2cr/u}\left[e^{2cR/u}\left(\frac{Ru}{2c}-\frac{u^2}{4c^2}\right)+e^{-2cR/u}\left(\frac{Ru}{2c}+\frac{u^2}{4c^2}\right)\right]
\end{multline}

while for the second

\begin{multline}\label{intx_more}
X_{>}(r, u | R) =\int_0^R x \left(e^{-2c|r-x|/u}-e^{-2c(r+x)/u}\right)  dx = \\
\int_0^R x \left(e^{-2c(x-r)/u}-e^{-2c(x+r)/u}\right)  dx = \\ \left(e^{2cr/u}-e^{-2cr/u}\right)\left[-\frac{Ru}{2c}e^{-2Rc/u}-\frac{u^2}{4c^2}(e^{-2Rc/u}-1)\right]
\end{multline}

. It then follows that the full term can be expressed as

\begin{multline}
\delta V_S(r) =  -\frac{\alpha^2Z}{2\pi rR^3}\int_0^1 du \sqrt{1-u^2}\left(1+\frac{1}{2}u^2\right) \times \\
\left[X_{<}(r, u | \min(r, R)) + X_{>}(r, u | R) -X_{>}(r, u | \min(r, R))\right]
\end{multline}

which is the expression used for the Uehling potential in the implementation. The integration over $u$ can be carried out numerically.

\subsection{Electronic shielding}

The effect of other electrons orbiting the nucleus in shielding its positive charge from the muon, thus shifting the energy, is usually quite small. It becomes bigger for heavier nuclei and higher muon transitions, but in practice it never seems to exceed $\sim100 \,\mathrm{eV}$ in most cases that matter \cite{borie1982}. Accounting for it in full would require one to solve the Schr\"{o}dinger or Dirac equation simultaneously for the muon and for all orbiting electrons, using methods such as Density Functional Theory to account for the many-body interactions. This method would be overly complex and time consuming for a minimal gain in accuracy. Here we elect instead to make use of the method developed by Tauscher et al. \cite{tauscher1978}. This approximation uses the following algorithm:

\begin{itemize}
	\item treat the muon as close enough to the nucleus to shield completely its charge, thus reducing it to Z-1;
	\item compute the density of the electrons in the n=1 shell as if they occupied unperturbed orbitals for a hydrogen-like atom;
	\item subtract the total charge of the electrons added in this way from the effective nuclear charge that determines the orbitals of the electrons in the shell above; repeat until all electrons are placed.
\end{itemize}

So, for example, for a neutral sodium atom (Z=11), one would construct a total density consisting of:

\begin{itemize}
	\item 2 electrons in a 1s orbital calculated with Z = 10;
	\item 8 electrons distributed between a 2s and a 2p orbital, both calculated with Z = 8;
	\item 1 electron in a 3s orbital calculated with Z = 1.
\end{itemize}

In this way we account crudely for the shielding effect that inner electrons have on outer ones. The potential from this charge background is then calculated with the integration technique described in section \ref{subsec_bkg_pot}, and the result is added to the other terms (Coulomb and Uehling). The Uehling correction to the muon-electron interactions is considered trivial and ignored. This method has been shown to give the correct electronic shielding energy contribution for muons to a 5\% accuracy.

\section{Dipole matrix elements}

To compute the transition probabilities between two states in presence of an electromagnetic field we need to compute the dipole matrix element between them. For spontaneous emission between two states $a$ and $b$, in atomic units, we have \cite{payne1955}

\begin{equation}\label{trans_prob}
W_{ab} = \frac{4}{3}\frac{E_{ab}}{c}|\braket{a}{|\vec{\alpha}|j_0(kr)}{b}|^2
\end{equation}

with $E_{ab}$ transition energy, the wave vector has magnitude $k=E_{ab}/c$, and $\vec{\alpha}$ is the vector of Dirac matrices $\alpha_x, \alpha_y, \alpha_z$.
If we consider the wavefunction written as seen in \ref{dirac_wavef}, 
then it follows that each individual matrix element can be written as

\begin{align}\label{matel_alphaj0}
\braket{a}{\alpha_ij_0(kr)}{b} = & i\braket{k_a\mu_a}{\sigma_i}{-k_b\mu_b}\int_{0}^{\infty}j_0(kr)P_aQ_b dr - \\
& i\braket{-k_a\mu_a}{\sigma_i}{k_b\mu_b}\int_{0}^{\infty}j_0(kr)P_bQ_a dr \nonumber
\end{align}

with the $\sigma_i$ being the Pauli matrices, keeping in mind that

\begin{equation}
\alpha_i = \begin{bmatrix}
0 & \sigma_i \\
-\sigma_i & 0
\end{bmatrix}
\end{equation}

. It should be recalled that in Eq. \ref{matel_alphaj0} the minus sign appears because the part in the bra is the adjoint, and not merely the complex conjugate, of the wavefunction. Now, keeping in mind Eq. \ref{dirac_kmu} and \ref{dirac_spharm}, and shortening the Clebsch-Gordan symbols seen in Eq. \ref{dirac_cgsym} as $c_{k\mu}^s = c(l,\frac{1}{2};\mu-s, s)$, we have

\begin{equation}
\ket{k\mu} = \begin{bmatrix}
c_{k\mu}^{1/2} Y_{l,\mu-1/2} \\
c_{k\mu}^{-1/2} Y_{l,\mu+1/2} \\
\end{bmatrix}
\end{equation}

and therefore,

\begin{equation}\label{matel_sz}
\braket{k'\mu'}{\sigma_z}{k\mu} = \left(c_{k'\mu'}^{1/2}c_{k\mu}^{1/2}-c_{k'\mu'}^{-1/2}c_{k\mu}^{-1/2}\right)\delta_{ll'}\delta_{\mu\mu'}
\end{equation}

\begin{equation}\label{matel_sp}
\braket{k'\mu'}{\sigma_+}{k\mu} = c_{k'\mu'}^{1/2} c_{k\mu}^{-1/2}\delta_{ll'}\delta_{\mu+1\mu'}
\end{equation}

\begin{equation}\label{matel_sm}
\braket{k'\mu'}{\sigma_-}{k\mu} = c_{k'\mu'}^{-1/2} c_{k\mu}^{1/2}\delta_{ll'}\delta_{\mu\mu'+1}
\end{equation}

. If we also set for brevity

\begin{equation}\label{pq_ints}
J_{ab} = \int_{0}^{\infty}j_0(kr)P_aQ_b dr
\end{equation}

, and we consider that if to a certain $k$ corresponds an $l$, then to $-k$ corresponds $l-\mathrm{sgn}(k)$, then Eq. \ref{matel_alphaj0} reduces to

\begin{align}\label{matel_alphaxj0}
\braket{a}{\alpha_xj_0(kr)}{b} = & i\left[\left(c_{k_a\mu_a}^{1/2} c_{-k_b\mu_b}^{-1/2}\delta_{\mu_a\mu_b+1}
+ c_{k_a\mu_a}^{-1/2} c_{-k_b\mu_b}^{1/2}\delta_{\mu_a+1\mu_b}\right)
\delta_{l_al_b-\mathrm{sgn}(k_b)} J_{ab}  - \right. \\
&\left. 
\left(c_{-k_a\mu_a}^{1/2} c_{k_b\mu_b}^{-1/2}\delta_{\mu_a\mu_b+1}
+ c_{-k_a\mu_a}^{-1/2} c_{k_b\mu_b}^{1/2}\delta_{\mu_a+1\mu_b}\right)
\delta_{l_a-\mathrm{sgn}(k_a)l_b} J_{ba} 
\right] \nonumber
\end{align}

\begin{align}\label{matel_alphayj0}
\braket{a}{\alpha_yj_0(kr)}{b} = & -\left[\left(c_{k_a\mu_a}^{1/2} c_{-k_b\mu_b}^{-1/2}\delta_{\mu_a\mu_b+1}
- c_{k_a\mu_a}^{-1/2} c_{-k_b\mu_b}^{1/2}\delta_{\mu_a+1\mu_b}\right)
\delta_{l_al_b-\mathrm{sgn}(k_b)} J_{ab}  - \right. \\
&\left. 
\left(c_{-k_a\mu_a}^{1/2} c_{k_b\mu_b}^{-1/2}\delta_{\mu_a\mu_b+1}
- c_{-k_a\mu_a}^{-1/2} c_{k_b\mu_b}^{1/2}\delta_{\mu_a+1\mu_b}\right)
\delta_{l_a-\mathrm{sgn}(k_a)l_b} J_{ba} 
\right] \nonumber
\end{align}

\begin{align}\label{matel_alphazj0}
\braket{a}{\alpha_zj_0(kr)}{b} = & i\left[\left(c_{k_a\mu_a}^{1/2} c_{-k_b\mu_b}^{1/2}-
 c_{k_a\mu_a}^{-1/2} c_{-k_b\mu_b}^{-1/2}\right)
\delta_{l_al_b-\mathrm{sgn}(k_b)} J_{ab}  - \right. \\
&\left. 
\left(c_{-k_a\mu_a}^{1/2} c_{k_b\mu_b}^{1/2}-
c_{-k_a\mu_a}^{-1/2} c_{k_b\mu_b}^{-1/2}\right)\delta_{l_a-\mathrm{sgn}(k_a)l_b} J_{ba} 
\right]\delta_{\mu_a\mu_b} \nonumber
\end{align}

. From these it becomes then easy to compute the transition probability as seen in Eq. \ref{trans_prob}. The transition rules are easily seen: only transitions with $\Delta l = \pm 1$ and $\Delta \mu = 0, \pm1$ are allowed. The integrals $J_{ab}$ can be computed numerically.

\chapter{Numerical implementation}

\section{Integration of the Dirac equation system}

\subsection{Grid}

The radial Dirac equation as written in \ref{dirac_sys} constitutes a system of two coupled first order differential equations. We use the shooting method to solve this problem. This approach requires one to choose the expected eigenvalue $E$ as a parameter, choose suitable guesses for the values at the 
, then integrate numerically the equation from both sides of the domain up to a meeting point. The parameter is then adjusted based on how well the solutions match until stability is reached.\newline
There are various practical issues involved in solving the equation this way. The first thing is the grid to use. Here we choose to use a logarithmic radial grid, defined as:

\begin{equation}
r = r_0e^x \qquad x = \log\left(\frac{r}{r_0}\right)
\end{equation}

In this format the equations become

\begin{align}\label{dirac_sys_log}
\frac{\partial Q}{dx} &= kQ + r(x)\left(mc-\frac{E-V(x)}{c}\right)P \\
\frac{\partial P}{dx} &= -kP + r(x)\left(mc+\frac{E-V(x)}{c}\right)Q
\end{align}

The advantage is that an evenly spaced grid in $x$ is now much denser for small $r$, namely, for a Coulomb-like potential, close to the nucleus, where the wavefunction will vary more quickly.

\subsection{Boundary conditions}
Another issue is that of the boundary conditions. For $r \rightarrow \infty$, one can see how $V \rightarrow 0$ and the equations reduce to \cite{silbar2010}

\begin{align}\label{dirac_sys_inf}
Q' &\approx \left(mc-\frac{E}{c}\right)P \\
P' &\approx \left(mc+\frac{E}{c}\right)Q
\end{align}

leading to the conditions (defining $K = \sqrt{m^2c^2-E^2/c^2}$):

\begin{align}
P(r) &\approx e^{-Kr} \\
Q(r) &\approx -\frac{K}{mc+E/c}P(r)
\end{align}

whereas for $r \rightarrow 0$ we find different results depending on whether we use a `true' Coulomb potential (point charge) or one where the charge is assumed to have a finite spherical size. By expanding $P$, $Q$ and $V$ in power series for a point charge we find \cite{grant2009}

\begin{align}
P(r) &\approx r^{\gamma} \\
Q(r) &\approx -\frac{Z}{c(\gamma-k)}P(r)
\end{align}

with $\gamma = \sqrt{k^2-Z^2\alpha^2}$, while for a finite charge for $k < 0$ we have

\begin{align}
P(r) &\approx r^{-k} \\
Q(r) &\approx \frac{3Z}{2cR(-2k+1)}r^{-k+1}
\end{align}

whereas for $k > 0$

\begin{align}
P(r) &\approx r^{k+2} \\
Q(r) &\approx \frac{2cR(2k+1)}{3Z}r^{k+1}
\end{align}

making use of the fact that $V(0) = -3Z/2R$ for a uniformly charged spherical nucleus.

\subsection{Potential}\label{num_pot}

The electrostatic potential for the equation can be built out of multiple parts, representing the various contributions. Which ones are used depend on the desired level of accuracy.

\subsubsection{Coulomb potential}

The fundamental potential to apply is always the basic Coulomb potential. For a point-like nuclear charge, this is simply:

\begin{equation}
	V_N(r) = -\frac{Z}{r}
\end{equation}

It should be noted that since we're dealing with negative muons, all potential terms are implicit multiplied by one negative unit of charge, which is the cause of the minus sign. In case one considers a finite sized spherical nucleus of uniform charge and radius $R$, one finds:

\begin{equation}
V_N(r) = \begin{cases}
-\frac{Z}{R}\left(\frac{3}{2}-\frac{1}{2}\frac{r^2}{R^2}\right), & \text{$r\leq R$}.\\
-\frac{Z}{r}, & \text{$r > R$}.
\end{cases}
\end{equation}

\subsubsection{Potential from a radial charge distribution}\label{subsec_bkg_pot}
In presence of an arbitrary radial charge distribution, one builds the potential by integrating the equation:

\begin{equation}
\nabla^2 V = \rho
\end{equation}

which in radial coordinates becomes

\begin{equation}
	\frac{\partial}{\partial r}\left(r^2	\frac{\partial V}{\partial r}\right) = 4\pi r^2 \rho(r)
\end{equation}

where $4\pi r^2 \rho(r)$ represents the charge density of a spherical shell. Since we're using a logarithmic grid, when expressing the derivatives with respect to the $\log(r)$ we have

\begin{equation}
\frac{\partial^2 V}{\partial x^2} + \frac{\partial V}{\partial x}= 4\pi r^2 \rho(r)
\end{equation}

Due to the presence of a first order derivative this equation can not be integrated using Numerov's method. Instead, a finite order derivative scheme was used making use of the following approximations:

\begin{align}
\left.\frac{\partial V}{\partial x}\right|_i &\approx \frac{1}{h}\left(\frac{11}{6}V_i -3V_{i-1} +\frac{3}{2}V_{i-2}-\frac{1}{3}V_{i-3} \right) \\
\left.\frac{\partial^2 V}{\partial x^2}\right|_i &\approx \frac{1}{h^2}\left(2V_i -5V_{i-1} +4V_{i-2}-V_{i-3} \right) \\
\end{align}

setting the first three points of V with an approximation of constant charge for $r < r_0$ and shooting outwards for all the following ones.\newline 
When the charge is defined on a limited radial grid, one also has the problem of what to use outside of its bounds. The convention adopted in the software is to always make it so that $V(\infty) = 0$ and to assume the charge to be constant inside the innermost radius and zero outside the outermost one. So if the grid gives us a charge distribution $\rho(r)$ defined between $R_{in}$ and $R_{out}$, and the resulting integrated potential is $V_{grid}(r)$, we will then define the total potential as

\begin{equation}
V_{bkg}(r) = \begin{cases}
-\frac{Q}{r}\qquad & r > R_{out} \\
V_{grid}(r) -V_{grid}(R_{out}) - \frac{Q}{R_{out}} \qquad & R_{out} \geq r > R_{in} \\
\frac{2}{3}\pi r^2\rho(R_{in})-V_{grid}(R_{out}) - \frac{Q}{R_{out}} \qquad & r \leq R_{in}
\end{cases}
\end{equation} 

where 

\begin{equation}
Q = \int_{R_{in}}^{R_{out}} 4\pi r^2\rho(r) dr + \frac{4}{3}\pi R_{in}^3\rho(R_{in})
\end{equation}

is the total charge of the background (including a term counting the assumed constant charge within the innermost radius of the grid).

\subsubsection{Uehling potential}

Both the nucleus and the charge distribution give rise to a further term due to vacuum polarizability. The full form for this has been presented in \ref{vacpot}.

\subsection{Integration scheme}

In order to integrate numerically the equations we make use of a fourth order Runge-Kutta method (RK4) \cite{press1992} adapted to work with coupled differential equations. Specifically, to integrate a system of the form:

\begin{align}\label{rk_qp}
Q'_i &= AA_i Q_i + AB_iP_i \\
P'_i &= BA_i Q_i + BB_iP_i
\end{align}

we apply the following rule:

\begin{align}
Q_i &= Q_{i-1} + \frac{1}{6}\left(k_{Q1}+2k_{Q2}+2k_{Q3}+k_{Q4}\right) \\
P_i &= P_{i-1} + \frac{1}{6}\left(k_{P1}+2k_{P2}+2k_{P3}+k_{P4}\right)
\end{align}

where we define

\begin{align}
k_{Q1} &= h\left(AA_{i-1}Q_{i-1}+AB_{i-1}P_{i-1}\right) \\
k_{Q2} &= h\left[AA_{i-1/2}\left(Q_{i-1}+\frac{k_{Q1}}{2}\right)+
AB_{i-1/2}\left(P_{i-1}+\frac{k_{P1}}{2}\right)\right] \\
k_{Q3} &= h\left[AA_{i-1/2}\left(Q_{i-1}+\frac{k_{Q2}}{2}\right)+
AB_{i-1/2}\left(P_{i-1}+\frac{k_{P2}}{2}\right)\right] \\
k_{Q4} &= h\left[AA_{i}(Q_{i-1}+k_{Q3})+AB_{i}(P_{i-1}+k_{P3})\right] \\
\end{align}

with similar expressions for the $k_P$, and with half-integers indices meaning $AA_{i-1/2} = (AA_i+AA_{i-1})/2$.

\subsection{Finding the eigenvalue}

The equations are integrated forward from $r\approx0$ and backwards from $r\approx\infty$ up to a meeting point. This is chosen to be the `turning point', namely the first point on the grid (going outwards) for which

\begin{equation}
E-mc^2 = B < V(r)
\end{equation}

where we call $B$ the `binding energy' of the particle, corresponding to the traditional energy eigenvalue in the Schr\"{o}dinger equation. This is the effective energy the particle has at its disposal to escape the potential, besides its rest mass energy term $mc^2$.\newline
Since the wavefunctions are not normalized yet, their values can all be scaled by a constant term. This means that comparing them directly is meaningless. Rather, in order to find whether the solutions `match', one can impose the condition:

\begin{equation}
\left. \frac{Q}{P}\right|_f = \left. \frac{Q}{P}\right|_b
\end{equation}

with f and b indicating forward or backwards integration. Since this is not usually the case, one will attempt a first value of $E$, then try to calculate 

\begin{equation}
\frac{\partial}{\partial E}\left(\left. \frac{Q}{P}\right|_f - \left. \frac{Q}{P}\right|_b\right) = 
\frac{\partial}{\partial E}\left. \frac{Q}{P}\right|_f - \frac{\partial}{\partial E}\left. \frac{Q}{P}\right|_b
\end{equation}

to then use a steepest descent algorithm to find the correct value of $E$. This tends to be a very well behaved function, so optimisation is straightforward. One approach to doing this is numerical - one simply integrates the equation both at $E$ and $E+\delta E$, then computes the derivative from the difference of the values found. However it's more efficient to look directly at the behaviour of $y = Q/P$ as its own function. By dividing $Q'$ by $P$ and defining for convenience:

\begin{equation}
g_\pm = \left(mc\pm\frac{E-V}{c}\right)
\end{equation}

we have

\begin{equation}
\frac{Q'}{P} = \frac{k}{r}\frac{Q}{P}+g_-
\end{equation}

and since (making use of the other equation for $P'$)

\begin{equation}
y' = \frac{Q'}{P} - \frac{Q}{P^2}P' = \frac{Q'}{P} + \frac{k}{r} y -g_+y^2
\end{equation}

we have

\begin{equation}\label{y_err_ode}
y' = 2\frac{k}{r}y-g_+y^2+g_-
\end{equation}

However what we are interested in is $\zeta = \partial y / \partial E$. We can derive and find:

\begin{equation}\label{zeta_err_ode}
\zeta' = 2\left(\frac{k}{r}-g_+y\right)\zeta-\frac{1}{c}(y^2+1)
\end{equation}

It should be noted that integrating this expression becomes problematic around nodes of the function $P$, where $y$ has a singularity. However, this problem can easily be fixed as a very similar expression can be written looking at the inverse ratio, $P/Q$, and substituting it in Eq. \ref{y_err_ode}:

\begin{equation}\label{eta_err_ode}
\eta' =\frac{\partial^2}{\partial E\partial x}\left(\frac{1}{y}\right) = -\frac{1}{y^2}\zeta' = -2\left(\frac{k}{r}+g_-\frac{1}{y}\right)\eta+\frac{1}{c}(\frac{1}{y^2}+1)
\end{equation}

Since we already know the values of Q and P, and thus of y, it's possible to integrate numerically Eq. \ref{zeta_err_ode}, switching then to Eq. \ref{eta_err_ode} when $y$ becomes too big (in the code we use $|y|>\alpha$ as our threshold). Then we can find

\begin{equation}
\frac{\partial}{\partial E}\left. \frac{Q}{P}\right|_f - \frac{\partial}{\partial E}\left. \frac{Q}{P}\right|_b = \zeta_f-\zeta_b
\end{equation}

and this can be used in combination with a steepest descent algorithm to minimize $y_f-y_b$ with respect to $E$ and thus find the correct eigenvalue.


\bibliographystyle{unsrt}
\bibliography{DevelopmentGuide.bib}

\end{document}          
